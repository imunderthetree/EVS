@page
@model EVS.Pages.Teacher.MessagesModel
@{
    ViewData["Title"] = "Messages";
}
@section Sidebar {
    @await Html.PartialAsync("_TeacherSidebar")
}

<style>
    /* Local styles consistent with existing teacher pages */
    .messages-container {
        display: flex;
        gap: 20px;
        padding: 18px;
        font-family: Arial, sans-serif;
    }

    .conversations {
        width: 320px;
        min-width: 260px;
        background: #fff;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 720px;
    }

    .conversations .header {
        padding: 12px 14px;
        border-bottom: 1px solid #f0f0f0;
        font-weight: 600;
    }

    .conversations .search {
        padding: 10px 14px;
        border-bottom: 1px solid #f0f0f0;
    }

    .conversations .list {
        overflow-y: auto;
        padding: 6px 0;
        flex: 1;
    }

    .conv-item {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 10px 14px;
        cursor: pointer;
        border-bottom: 1px solid #f7f7f7;
    }

    .conv-item:hover {
        background: #fafafa;
    }

    .conv-item .avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: #ddd;
        flex: 0 0 44px;
        overflow: hidden;
    }

    .conv-item .avatar img { width: 100%; height: 100%; object-fit: cover; }

    .conv-item .meta {
        flex: 1;
        min-width: 0;
    }

    .conv-item .name {
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .conv-item .preview {
        font-size: 13px;
        color: #666;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .conv-item .time {
        font-size: 12px;
        color: #999;
        flex-shrink: 0;
    }

    .chat-pane {
        flex: 1;
        background: #fff;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        height: 720px;
        overflow: hidden;
    }

    .chat-header {
        padding: 12px 16px;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .chat-header .avatar {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        background: #ddd;
        overflow: hidden;
        flex: 0 0 52px;
    }

    .chat-header .avatar img { width: 100%; height: 100%; object-fit: cover; }

    .chat-messages {
        padding: 16px;
        overflow-y: auto;
        flex: 1;
        background: #fafbfd;
    }

    .message {
        max-width: 72%;
        padding: 10px 12px;
        border-radius: 12px;
        margin-bottom: 12px;
        font-size: 14px;
        line-height: 1.4;
    }

    .message.in {
        background: #e7f4ff;
        align-self: flex-start;
    }

    .message.out {
        background: #e9f7ea;
        align-self: flex-end;
    }

    .message .meta {
        font-size: 12px;
        color: #666;
        margin-top: 6px;
    }

    .composer {
        padding: 12px;
        border-top: 1px solid #f0f0f0;
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .composer textarea.form-control {
        resize: none;
        height: 64px;
    }

    @@media (max-width: 980px) {
        .messages-container { flex-direction: column; padding: 12px; }
        .conversations { width: 100%; height: 320px; }
        .chat-pane { height: 520px; }
    }
</style>

<div class="container-fluid">
    <h2 class="mb-4">Messages</h2>

    <div class="messages-container" role="region" aria-label="Teacher messaging interface">
        <!-- Conversations list -->
        <aside class="conversations" aria-label="Conversations">
            <div class="header">Conversations</div>

            <div class="search">
                <input class="form-control" type="search" placeholder="Search students or messages" aria-label="Search conversations" />
            </div>

            <div class="list" role="list">
                <div class="conv-item" role="listitem" aria-label="Conversation with John Doe">
                    <div class="avatar">
                        <img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="John Doe" />
                    </div>
                    <div class="meta">
                        <div class="name">John Doe</div>
                        <div class="preview">Can we schedule a revision session next week?</div>
                    </div>
                    <div class="time">Now</div>
                </div>

                <div class="conv-item" role="listitem" aria-label="Conversation with Sarah Miller">
                    <div class="avatar">
                        <img src="https://bootdey.com/img/Content/avatar/avatar4.png" alt="Sarah Miller" />
                    </div>
                    <div class="meta">
                        <div class="name">Sarah Miller</div>
                        <div class="preview">I uploaded my assignment - please check.</div>
                    </div>
                    <div class="time">Yesterday</div>
                </div>

                <div class="conv-item" role="listitem" aria-label="Conversation with Liam Chen">
                    <div class="avatar">
                        <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="Liam Chen" />
                    </div>
                    <div class="meta">
                        <div class="name">Liam Chen</div>
                        <div class="preview">Will the next test be multiple choice?</div>
                    </div>
                    <div class="time">2d</div>
                </div>

                <!-- Additional static sample items; replace with model-driven list -->
            </div>
        </aside>

        <!-- Chat area -->
        <section class="chat-pane" aria-label="Active conversation">
            <div class="chat-header">
                <div class="avatar">
                    <img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="John Doe" />
                </div>
                <div>
                    <div style="font-weight:600;">John Doe</div>
                    <div style="font-size:13px;color:#666;">Grade 10 • 10A</div>
                </div>
                <div style="margin-left:auto;font-size:13px;color:#999;">Online</div>
            </div>

            <div class="chat-messages" aria-live="polite">
                <div class="message in" role="article" aria-label="Message from John Doe">
                    <div>Good morning, sir. Can we have an extra revision session before the exam?</div>
                    <div class="meta">John Doe • 09:12 AM</div>
                </div>

                <div class="message out" role="article" aria-label="Message from you">
                    <div>Hi John — I can arrange a 30-minute revision after school on Friday.</div>
                    <div class="meta">You • 09:14 AM</div>
                </div>

                <div class="message in" role="article" aria-label="Message from John Doe">
                    <div>That would be great, thank you!</div>
                    <div class="meta">John Doe • 09:15 AM</div>
                </div>

                <!-- Static messages — replace with model-driven markup when wiring up -->
            </div>

            <div class="composer">
                <div class="input" style="flex:1;">
                    <textarea class="form-control" placeholder="Type a message..." aria-label="Message input"></textarea>
                </div>

                <div>
                    <button class="btn btn-outline-secondary" type="button" title="Attach">
                        <i class="fa fa-paperclip" aria-hidden="true"></i>
                    </button>
                </div>

                <div>
                    <button class="btn btn-primary" type="button" title="Send">
                        <i class="fa fa-paper-plane" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </section>
    </div>
</div>
