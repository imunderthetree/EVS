@page
@model EVS.Pages.Student.MessagesModel
@{
    ViewData["Title"] = "Messages";
}
@section Sidebar {
    @await Html.PartialAsync("_StudentSidebar")
}

<style>
    /* Local styles consistent with existing pages */
    .messages-container {
        display: flex;
        gap: 20px;
        padding: 18px;
        font-family: Arial, sans-serif;
    }

    .conversations {
        width: 320px;
        min-width: 260px;
        background: #fff;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 720px;
    }

        .conversations .header {
            padding: 12px 14px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 600;
        }

        .conversations .search {
            padding: 10px 14px;
            border-bottom: 1px solid #f0f0f0;
        }

        .conversations .list {
            overflow-y: auto;
            padding: 6px 0;
            flex: 1;
        }

    .conv-item {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 10px 14px;
        cursor: pointer;
        border-bottom: 1px solid #f7f7f7;
    }

        .conv-item:hover {
            background: #fafafa;
        }

        .conv-item .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #ddd;
            flex: 0 0 44px;
            overflow: hidden;
        }

            .conv-item .avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .conv-item .meta {
            flex: 1;
            min-width: 0;
        }

        .conv-item .name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conv-item .preview {
            font-size: 13px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conv-item .time {
            font-size: 12px;
            color: #999;
            flex-shrink: 0;
        }

    .chat-pane {
        flex: 1;
        background: #fff;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        height: 720px;
        overflow: hidden;
    }

    .chat-header {
        padding: 12px 16px;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

        .chat-header .avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: #ddd;
            overflow: hidden;
            flex: 0 0 52px;
        }

            .chat-header .avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

    .chat-messages {
        padding: 16px;
        overflow-y: auto;
        flex: 1;
        background: #fafbfd;
    }

    .message {
        max-width: 72%;
        padding: 10px 12px;
        border-radius: 12px;
        margin-bottom: 12px;
        font-size: 14px;
        line-height: 1.4;
    }

        .message.in {
            background: #e7f4ff;
            align-self: flex-start;
        }

        .message.out {
            background: #e9f7ea;
            align-self: flex-end;
        }

        .message .meta {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
        }

    .composer {
        padding: 12px;
        border-top: 1px solid #f0f0f0;
        display: flex;
        gap: 10px;
        align-items: center;
    }

        .composer textarea.form-control {
            resize: none;
            height: 64px;
        }

    /* Render the media query via Html.Raw to avoid Razor parsing of @@media */
    @Html.Raw(@"@media (max-width: 980px) {
        .messages-container {
            flex-direction: column;
            padding: 12px;
        }

        .conversations {
            width: 100%;
            height: 320px;
        }

        .chat-pane {
            height: 520px;
        }
    }")
</style>

<div class="container-fluid">
    <h2 class="mb-4">Messages</h2>

    <div class="messages-container" role="region" aria-label="Student messaging interface">
        <!-- Conversations list (sample) -->
        <aside class="conversations" aria-label="Conversations">
            <div class="header">Conversations</div>

            <div class="search">
                <input class="form-control" type="search" placeholder="Search teachers or messages" aria-label="Search conversations" />
            </div>

            <div class="list" role="list">
                <div class="conv-item" role="listitem">
                    <div class="avatar">
                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="Mrs. Smith" />
                    </div>
                    <div class="meta">
                        <div class="name">Mrs. Smith</div>
                        <div class="preview">Reminder: Homework feedback posted.</div>
                    </div>
                    <div class="time">Today</div>
                </div>

                <div class="conv-item" role="listitem">
                    <div class="avatar">
                        <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="Counselor" />
                    </div>
                    <div class="meta">
                        <div class="name">Guidance Counselor</div>
                        <div class="preview">Schedule for college counseling available.</div>
                    </div>
                    <div class="time">2d</div>
                </div>
            </div>
        </aside>

        <!-- Chat area (sample) -->
        <section class="chat-pane" aria-label="Active conversation">
            <div class="chat-header">
                <div class="avatar">
                    <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="Mrs. Smith" />
                </div>
                <div>
                    <div style="font-weight:600;">Mrs. Smith</div>
                    <div style="font-size:13px;color:#666;">Mathematics • Class 10A</div>
                </div>
                <div style="margin-left:auto;font-size:13px;color:#999;">Online</div>
            </div>

            <div class="chat-messages" aria-live="polite">
                <div class="message in" role="article">
                    <div>Don't forget to review chapter 5 before tomorrow's quiz.</div>
                    <div class="meta">Mrs. Smith • 08:30 AM</div>
                </div>

                <div class="message out" role="article">
                    <div>Thanks — I'll go through the examples tonight.</div>
                    <div class="meta">You • 08:35 AM</div>
                </div>
            </div>

            <div class="composer">
                <div class="input" style="flex:1;">
                    <textarea class="form-control" placeholder="Type a message..." aria-label="Message input"></textarea>
                </div>

                <div>
                    <button class="btn btn-outline-secondary" type="button" title="Attach">
                        <i class="fa fa-paperclip" aria-hidden="true"></i>
                    </button>
                </div>

                <div>
                    <button class="btn btn-primary" type="button" title="Send">
                        <i class="fa fa-paper-plane" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </section>
    </div>
</div>